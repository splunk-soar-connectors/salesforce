<!-- File: readme.html
  Copyright (c) 2017-2020 Splunk Inc.

  SPLUNK CONFIDENTIAL - Use or disclosure of this material in whole or in part
  without a valid written license from Splunk Inc. is PROHIBITED.
-->


<html>
    <head></head>
    <body>
        <h2>Authentication</h2>

        <p>To pass test connectivity, you need to configure an app on Salesforce. To do so, navigate to <a href="https://www.salesforce.com/" target="_blank">https://www.salesforce.com/</a> in a browser and navigate to the login page. Log in with a Salesforce account.</p>
        <ol>
            <li>In the drop-down list of the account (in the upper-right corner), select <b>Setup</b></li>
            <li>Go to <b>Apps</b>, then <b>App Manager</b> and click on <b>New Connected App</b></li>
            <li>On the New Connected App page, fill the following required fields under Basic Information:</li>
                <ul>
                    <li>Connected App Name. For example, Salesforce Phantom App</li>
                    <li>API name. For example, Salesforce Phantom App</li>
                    <li>Contact Email. For example, xyz@xyz.com</li>
                </ul>
            <li>Go to API (Enable OAuth Settings), and select Enable OAuth Settings. Fill it out as mention in the below picture or else follow these steps
            <ul>
                <li>Under the <b>Callback URL</b>, we will be updating the entry of https://phantom.local to reflect the actual redirect URI.  We will get this while we create Phantom App's asset in the below section titled "Configure the Salesforce Phantom app's Asset"</li>
                <li>Under <b>Selected OAuth Scopes field</b> add this two scopes from <b>Available OAuth Scopes</b>
                    <ul>
                        <li>Access and manage your data(api)</li>
                        <li>Perform requests on your behalf at any time(refresh_token,ofline_access)</li>
                    </ul></li>
                <li>Select <b>Require Secret for Web Server Flow</b> checkbox</li>
            <a href="/app_resource/salesforce_6c1316b0-88a7-4864-b684-3170f6c455be/img/app_config.png">
                    <img src="/app_resource/salesforce_6c1316b0-88a7-4864-b684-3170f6c455be/img/app_config.png">
                </a>
            </ul>
            </li>
            <li>Click on <b>Save</b></li>
        </ol>
        <h2>Configure the Salesforce Phantom app's Asset</h2>
        When creating an asset for the <b>Salesforce</b> app, place the <b>Consumer ID</b> of the app created during the previous step in the <b>Client ID</b> field and place the <b>Consumer Secret</b> generated during the app creation process in the <b>Client Secret</b> field. Then, click <b>SAVE</b>.
        <br><br>
        After saving, a new field will appear in the <b>Asset Settings</b> tab. Take the URL found in the <b>POST incoming for Salesforce to this location</b> field. To this URL, add <b>/start_oauth</b>. After doing so the URL should look something like:
        <br>
        <p>
            https://&lt;phantom_host&gt;/rest/handler/salesforce_6c1316b0-88a7-4864-b684-3170f6c455be/&lt;asset_name&gt;/start_oauth
        </p>
        <a href="/app_resource/salesforce_6c1316b0-88a7-4864-b684-3170f6c455be/img/asset_config.png">
            <img src="/app_resource/salesforce_6c1316b0-88a7-4864-b684-3170f6c455be/img/asset_config.png">
        </a>
        <br><br>
        <p>Click <b>Edit</b> on the app created in a previous step and place it in the <b>Callback URL</b> field.</p>
        Once again, click on Save.
        <h2>Method to Run Test Connectivity with Oauth</h2>
        <p>After setting up the asset, click the <b>TEST CONNECTIVITY</b> button. A window should pop up and display a URL as shown in the below picture. Navigate to this URL in a separate browser tab. This new tab will redirect to a Salesforce login page. Log in to a Salesforce account. Finally, close that tab when instructed to do. The test connectivity window should show a success.<b> The app should now be ready to use.</b></p>
        <br>
        <a href="/app_resource/salesforce_6c1316b0-88a7-4864-b684-3170f6c455be/img/modal.png">
            <img src="/app_resource/salesforce_6c1316b0-88a7-4864-b684-3170f6c455be/img/modal.png">
        </a>
        <br><br>
        <h2>Method to Run Test Connectivity with Username and Password</h2>
        <p>If you optionally specify username and password in the asset configuration, test connectivity will work differently;
            the main difference being that when you launch the test connectivity no need to manually login to the Salesforce to authorize the app.</p>
        <p><b>Note:</b> The password field should be composed of your password with your account's security token appended at the end.
            Example: MyPasswordMyToken (this is not the same as the <b>client_secret</b>)</p>
        <h2>Test Environment</h2>
        <p>
            You may want to configure an asset to work with a Salesforce test environment. This is the case if the login URL for
            that Salesforce instance is <a href="https://test.salesforce.com">https://test.salesforce.com</a> as opposed to
            <a href="https://login.salesforce.com">https://login.salesforce.com</a>. In this case, you should check the appropriate box in the
            asset configuration.
        </p>
        <h2>Ingestion</h2>
            <p>
            To ingest, you must use a ListView as a source.
            </p>
            <p>
            The created artifact's CEF fields will be the same names as the fields in the Object in Salesforce. You may want to map these to standard
            CEF fields. This can be done by providing a JSON that describes the mapping. For example, if the Salesforce object has the field
            <b>ip_address__c</b>, and you want this to be <b>sourceAddress</b>, the following file would be appropriate.
            <pre class="shell">
            <code>
            {
                "ip_address__c": "sourceAddress"
            }
            </code>
            </pre>
        <h3>'Include view data in artifact' Configuration Parameter</h3>
        <ul>
            <li>This configuration parameter can be used to prevent the creation of duplicate artifacts.</li>
            <li>If disabled, the on poll will ignore value of "LastViewedDate" and "LastReferencedDate" while artifact creation.</li>
            <li>If enabled, the on poll will include value of "LastViewedDate" and "LastReferencedDate" while artifact creation.</li>
            <li>Case is an example of an object in which both the values (LastViewedDate and LastReferencedDate) are present.</li>
        </ul>
        <h2>Note</h2>
        <ul>
            <li>Currently, the <b>List Objects</b>, the <b>List Tickets</b>, and the <b>On Poll</b> actions can fetch a maximum of 4000 records.</li>
            <li>The maximum offset value supported by the Salesforce API is 2000, as mentioned in this <a href="https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/sforce_api_calls_soql_select_offset.htm" target="_blank"><b>documentation</b>.</a></li>
            <li>If this issue gets resolved with the Salesforce API, then the mentioned actions will be able to fetch all the records.</li>
        </ul>
    </body>
</html>

